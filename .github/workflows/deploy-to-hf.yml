name: Deploy to Hugging Face Space

on:
  push:
    branches:
      - main  # run this workflow on every git push to the main branch
  workflow_dispatch:  # allow manual trigger from GitHub Actions UI

jobs:
  sync-to-huggingface:
    runs-on: ubuntu-latest  # runner: ephemeral (temporary) Ubuntu VM 

    steps:
      # Step 1: Clone the repository into the runner uing GitHub's checkout action  
      - name: Check out repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 0 for full git history, 1 for lastest commit only
          lfs: true  # enable Git LFS (for binary files like .png)

      # Step 2: Push the code to the Hugging Face Space repository
      - name: Push to Hugging Face Space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}   # access token (write access) created on HF and stored in GitHub repo secrets
          HF_USER: JensBender
          HF_SPACE: loan-default-prediction-app
        run: |
          # configure git to tell Hugging Face the push came from GitHub Actions and prevent “who are you?” errors  
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          # add Hugging Face Space as a remote repository
          git remote add hf https://$HF_USER:$HF_TOKEN@huggingface.co/spaces/$HF_USER/$HF_SPACE

          # push main branch of GitHub repo to main branch of Hugging Face Space repo
          # use force push to create exact mirror on HF Space, overwriting any changes made directly on HF
          git push --force hf main
